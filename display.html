<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>长治三毛业务数据采集展示</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .kv{display:flex;gap:8px;align-items:center;justify-content:flex-start;margin:6px 0;color:#0f172a}
    .kv .label{color:#6b7280}
    .container{max-width:1200px;margin:0 auto}
    pre{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:12px;overflow:auto;color:#111827}
    table{width:100%;border-collapse:collapse;background:#fff;border:1px solid #e5e7eb;border-radius:12px;overflow:hidden}
    th,td{border-bottom:1px solid #e5e7eb;padding:8px;text-align:left;color:#111827}
  </style>
</head>
<body>
  <section id="biz-display" class="view" style="padding-top:12px">
    <div class="container" style="width:95%;max-width:1400px">
      <header class="app-header">
        <div style="display:flex;align-items:center;gap:12px">
          <div style="width:46px;height:46px;display:flex;align-items:center;justify-content:center">
            <svg viewBox="0 0 64 64" width="46" height="46" aria-hidden="true">
              <defs>
                <radialGradient id="bg" cx="0.5" cy="0.4" r="0.7">
                  <stop offset="0%" stop-color="#7cc0ff"/>
                  <stop offset="100%" stop-color="#4f46e5"/>
                </radialGradient>
                <linearGradient id="cloud" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0%" stop-color="#ffffff"/>
                  <stop offset="100%" stop-color="#eef2ff"/>
                </linearGradient>
              </defs>
              <circle cx="32" cy="32" r="28" fill="url(#bg)"/>
              <g fill="#ffffff" opacity="0.9">
                <circle cx="18" cy="20" r="1.5"/>
                <circle cx="26" cy="14" r="1.2"/>
                <circle cx="40" cy="18" r="1.4"/>
                <circle cx="48" cy="26" r="1.1"/>
                <circle cx="22" cy="30" r="1"/>
              </g>
              <path d="M20 40c0-4 3.5-7 7.5-7 .3-5.5 4.8-9.5 10.1-9.5 5.2 0 9.5 3.8 10 9 4.1.2 7.4 3.4 7.4 7.3 0 4.1-3.6 7.4-8 7.4H26.5c-3.6 0-6.5-2.9-6.5-6.2z" fill="url(#cloud)" stroke="#e5e7eb" stroke-width="1.2"/>
              <path d="M12 28 l2 -4 l2 4 l4 2 l-4 2 l-2 4 l-2 -4 l-4 -2z" fill="#ffd166" opacity="0.8"/>
            </svg>
          </div>
          <div style="display:flex;align-items:center;gap:16px">
            <span style="font-weight:700;color:#111827;font-size:28px;line-height:1.1">星空云</span>
            <div class="brand">长治三毛业务数据采集展示</div>
          </div>
        </div>
        <div class="spacer"></div>
        <div class="user-area"><button id="display-back" class="secondary">返回中台</button><button id="display-logout" class="link">退出</button></div>
      </header>
      <div class="panel" style="margin-top:12px">
        <div class="kv"><span class="label">TimeKay:</span><span id="val-b1"></span><span class="label">1分钟内有效</span></div>
        <div class="kv"><span class="label">MAC:</span><span id="val-m1"></span></div>
        <div class="kv"><span class="label">调用地址:</span><span id="val-c1"></span></div>
        <div class="kv"><span class="label">拼接串:</span><span id="val-n1"></span></div>
        <div style="height:12px"></div>
        <div style="margin:8px 0;font-size:14px;font-weight:600;color:#111827">从长治三毛业务系统采集到的数据如下：</div>
        <div style="margin:8px 0">
          <div class="label">原始返回JSON：</div>
          <pre id="raw-json"></pre>
        </div>
        <div style="margin:8px 0">
          <div class="label">Data表格：</div>
          <table>
            <thead>
              <tr>
                <th>业务编号</th><th>业务类型</th><th>WXOpenID</th><th>Balance</th><th>Score</th><th>ValidTime</th><th>State</th><th>IssueTime</th><th>Name</th><th>Mobile</th><th>Sex</th><th>BirthDate</th><th>UpTime</th>
              </tr>
            </thead>
            <tbody id="data-tbody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <script>
    const rawBox=document.getElementById('raw-json');
    const tB1=document.getElementById('val-b1');
    const tM1=document.getElementById('val-m1');
    const tC1=document.getElementById('val-c1');
    const tN1=document.getElementById('val-n1');
    const tableBody=document.getElementById('data-tbody');
    const backBtn=document.getElementById('display-back'); if(backBtn){backBtn.onclick=()=>{window.location.href='/center.html';}};
    const logoutBtn=document.getElementById('display-logout'); if(logoutBtn){logoutBtn.onclick=()=>{localStorage.removeItem('user'); localStorage.removeItem('token'); window.location.href='/';}};
    try{
      const pack=JSON.parse(sessionStorage.getItem('bizResult')||'{}');
      tB1.textContent=pack.B1||'';
      tM1.textContent=pack.M1||'';
      tC1.textContent=pack.C1||'';
      tN1.textContent=pack.N1||'';
      rawBox.textContent=typeof pack.resp==='string'?pack.resp:JSON.stringify(pack.resp||{}, null, 2);
      const data=pack?.resp?.Data;
      const records=Array.isArray(data)?data:(data?[data]:[]);
      if(records.length===0){
        const tr=document.createElement('tr'); const td=document.createElement('td'); td.colSpan=13; td.textContent='暂无数据'; tr.appendChild(td); tableBody.appendChild(tr);
      }else{
        records.forEach(it=>{
          const row=[it.CardNo,it.CardType,it.WXOpenID,it.Balance,it.Score,it.ValidTime,it.State,it.IssueTime,it.Name,it.Mobile,it.Sex,it.BirthDate,it.UpTime];
          const tr=document.createElement('tr'); row.forEach(v=>{const td=document.createElement('td'); td.textContent=(v==null?'':String(v)); tr.appendChild(td);}); tableBody.appendChild(tr);
        });
      }
    }catch(e){ rawBox.textContent='无有效结果'; }
  </script>
</body>
</html>